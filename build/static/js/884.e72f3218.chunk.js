"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[884],{68438:(e,a,t)=>{t.d(a,{Z:()=>l});var i=t(74569),s=t.n(i);s().defaults.baseURL="".concat("https://qashqadaryo.leapmotorca.uz/api"),s().interceptors.request.use((e=>{const a=(e=>{try{return localStorage.getItem(e)}catch(a){console.log("Error getting data")}})("lptoken"),t=null!==a?"Bearer ".concat(a):"";return e.headers.authorization=t,e}));const o=s(),l={async getData(e){const{data:a}=await o.get(e);return a},async getDataByID(e,a){const{data:t}=await o.get("".concat(e,"/").concat(a));return t},async postData(e,a){const{data:t}=await o.post(e,a);return t},async editData(e,a,t){const{data:i}=await o.put("".concat(e,"/").concat(t),a);return i},async deleteData(e,a){await o.delete("".concat(e,"/").concat(a))},async deleteImages(e,a){console.log("delete image",a),await o.delete(e,{data:a})}}},87884:(e,a,t)=>{t.r(a),t.d(a,{default:()=>I});var i=t(72791),s=t(2409),o=t(50419),l=t(66106),n=t(30914),r=t(93086),d=t(87309),u=t(68117),c=t(91933),m=t(68438),g=t(98986),p=t(57689),v=t(16030),f=t(77221),h=t(80184);const y={mediaId:[""]},I=()=>{const[e]=s.Z.useForm(),a=(0,p.s0)(),{editId:t}=(0,v.v9)((e=>e.editData)),I=(0,v.I0)(),[w,Z]=(0,i.useState)([]),[S,F]=(0,i.useState)([]),[E,b]=(0,i.useState)({}),[D,P]=(0,i.useState)(!1),[j,x]=(0,i.useState)([]),{mutate:L,data:V,isLoading:C,isSuccess:O,error:q,isError:k}=(0,c.useMutation)((e=>{let{url:a,data:t}=e;return m.Z.postData(a,t)}),{onSuccess:()=>o.ZP.success("Success"),onError:e=>o.ZP.error(e.message)}),{mutate:M,data:R,isLoading:J,isSuccess:U}=(0,c.useMutation)((e=>{let{url:a,formData:t}=e;return m.Z.postData(a,t)}),{onError:e=>o.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{isLoading:z,data:B,refetch:G,isSuccess:N}=(0,c.useQuery)(["edit-filialInner",t],(()=>m.Z.getDataByID("/filialInner",t)),{enabled:!1}),{mutate:T,isLoading:_,data:A,isSuccess:Q,error:H,isError:W}=(0,c.useMutation)((e=>{let{url:a,data:t,id:i}=e;return m.Z.editData(a,t,i)}),{onError:e=>o.ZP.error(e.message)}),{mutate:K}=(0,c.useMutation)((e=>{let{url:a,ids:t}=e;return m.Z.deleteImages(a,t)}),{onSuccess:()=>o.ZP.success("Success"),onError:e=>o.ZP.error(e.message)});(0,i.useEffect)((()=>{let e=[];if(Q&&I({type:f.Pb,payload:""}),null===j||void 0===j||j.map((a=>{N&&null!==a&&void 0!==a&&a.uid&&e.push(null===a||void 0===a?void 0:a.uid)})),N&&e.length>0){K({url:"/medias",ids:{ids:e}})}(O||Q)&&a("/filialInner")}),[V,A]),(0,i.useEffect)((()=>{k&&o.ZP.error(q.message),W&&o.ZP.error(H.message)}),[q,H]),(0,i.useEffect)((()=>{""!==t&&G()}),[t]),(0,i.useEffect)((()=>{""===t&&e.setFieldsValue(y)}),[]),(0,i.useEffect)((()=>{const a=[];for(let e=0;e<(null===B||void 0===B||null===(t=B.images)||void 0===t?void 0:t.length);e++){var t,i,s,o,l;const n={uid:null===B||void 0===B||null===(i=B.images[e])||void 0===i?void 0:i._id,name:null===B||void 0===B||null===(s=B.images[e])||void 0===s?void 0:s.name,location:null===B||void 0===B||null===(o=B.images[e])||void 0===o?void 0:o.path,status:"done",url:"".concat("https://qashqadaryo.leapmotorca.uz/api","/").concat(null===B||void 0===B||null===(l=B.images[e])||void 0===l?void 0:l.path)};a.push(n)}if(N){const t={mediaId:a};Z(a),e.setFieldsValue(t)}}),[B]),(0,i.useEffect)((()=>{let e=[],a=[];a=U?S.concat(R):[...S];const i=[];a.map((e=>{var a;null!==e&&void 0!==e&&null!==(a=e.originFileObj)&&void 0!==a&&a.uid||i.push(e)})),!N&&R?null===R||void 0===R||R.map((a=>{e.push(null===a||void 0===a?void 0:a._id)})):i.map((a=>{null!==a&&void 0!==a&&a.uid?e.push(null===a||void 0===a?void 0:a.uid):e.push(null===a||void 0===a?void 0:a._id)}));const s={mediaId:e};U&&!N?L({url:"/filialInner",data:s}):(D||U)&&T({url:"/filialInner",data:s,id:t})}),[R,E]);(0,i.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const t=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",t),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]);return(0,h.jsx)("div",{children:J||C||z||_?(0,h.jsx)(g.QP,{}):(0,h.jsxs)(s.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:y,onFinish:e=>{const a=new FormData;let t=!1;null===w||void 0===w||w.map((e=>{var i;N?null!==e&&void 0!==e&&null!==(i=e.originFileObj)&&void 0!==i&&i.uid?(t=!0,a.append("media",null===e||void 0===e?void 0:e.originFileObj),P(!1),F(w)):(t=!1,F(w),P(!0)):(t=!0,a.append("media",null===e||void 0===e?void 0:e.originFileObj))})),t&&!U&&M({url:"/medias",formData:a}),b(e)},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,h.jsx)(l.Z,{gutter:20,children:(0,h.jsx)(n.Z,{span:12,children:(0,h.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,h.jsx)(u.Z,{rotationSlider:!0,children:(0,h.jsx)(r.Z,{maxCount:2,fileList:w,listType:"picture-card",onChange:a=>{let{fileList:t}=a;Z(t),e.setFieldsValue({mediaId:t})},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const t=new FileReader;t.readAsDataURL(e.originFileObj),t.onload=()=>a(t.result)})));const t=new Image;t.src=a;const i=window.open(a);null===i||void 0===i||i.document.write(t.outerHTML)},beforeUpload:()=>!1,onRemove:e=>{if(N){const a=[...j];a.push(e),x(a)}},children:w.length>1?"":"Upload"})})})})}),(0,h.jsx)(d.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:N?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=884.e72f3218.chunk.js.map