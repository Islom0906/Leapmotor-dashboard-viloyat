"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[243],{68438:(i,e,l)=>{l.d(e,{Z:()=>n});var d=l(74569),o=l.n(d);o().defaults.baseURL="".concat("https://namangan.leapmotorca.uz/api"),o().interceptors.request.use((i=>{const e=(i=>{try{return localStorage.getItem(i)}catch(e){console.log("Error getting data")}})("lptoken"),l=null!==e?"Bearer ".concat(e):"";return i.headers.authorization=l,i}));const a=o(),n={async getData(i){const{data:e}=await a.get(i);return e},async getDataByID(i,e){const{data:l}=await a.get("".concat(i,"/").concat(e));return l},async postData(i,e){const{data:l}=await a.post(i,e);return l},async editData(i,e,l){const{data:d}=await a.put("".concat(i,"/").concat(l),e);return d},async deleteData(i,e){await a.delete("".concat(i,"/").concat(e))},async deleteImages(i,e){console.log("delete image",e),await a.delete(i,{data:e})}}},32243:(i,e,l)=>{l.r(e),l.d(e,{default:()=>F});var d=l(72791),o=l(2409),a=l(50419),n=l(66106),t=l(30914),r=l(93086),u=l(87309),s=l(68117),v=l(91933),c=l(68438),m=l(98986),g=l(57689),p=l(16030),b=l(77221),f=l(80184);const j={mediaLogoId:"",mediaBrandId:"",mediaVideoId:""},F=()=>{const[i]=o.Z.useForm(),e=(0,g.s0)(),{editId:l}=(0,p.v9)((i=>i.editData)),F=(0,p.I0)(),[h,O]=(0,d.useState)([]),[I,Z]=(0,d.useState)([]),[w,S]=(0,d.useState)([]),[y,L]=(0,d.useState)({}),[x,E]=(0,d.useState)(!1),[P,D]=(0,d.useState)({}),[V,_]=(0,d.useState)({}),[B,C]=(0,d.useState)({}),{mutate:U,data:R,isLoading:k,isSuccess:z,error:M,isError:T}=(0,v.useMutation)((i=>{let{url:e,data:l}=i;return c.Z.postData(e,l)}),{onSuccess:()=>a.ZP.success("Success"),onError:i=>a.ZP.error(i.message)}),{mutate:q,data:J,isLoading:G,isSuccess:N}=(0,v.useMutation)((i=>{let{url:e,formData:l}=i;return c.Z.postData(e,l)}),{onError:i=>a.ZP.error(i.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{isLoading:A,data:Q,refetch:H,isSuccess:W}=(0,v.useQuery)(["edit-banner",l],(()=>c.Z.getData("/banner")),{enabled:!1}),{mutate:K,isLoading:X,data:Y,isSuccess:$,error:ii,isError:ei}=(0,v.useMutation)((i=>{let{url:e,data:l,id:d}=i;return c.Z.editData(e,l,d)}),{onError:i=>a.ZP.error(i.message)}),{mutate:li}=(0,v.useMutation)((i=>{let{url:e,ids:l}=i;return c.Z.deleteImages(e,l)}),{onSuccess:()=>a.ZP.success("Success"),onError:i=>a.ZP.error(i.message)});(0,d.useEffect)((()=>{let i=[];if($&&F({type:b.Pb,payload:""}),W&&null!==P&&void 0!==P&&P.uid&&i.push(null===P||void 0===P?void 0:P.uid),W&&null!==V&&void 0!==V&&V.uid&&i.push(null===V||void 0===V?void 0:V.uid),W&&null!==B&&void 0!==B&&B.uid&&i.push(null===B||void 0===B?void 0:B.uid),W&&(null!==P&&void 0!==P&&P.uid||null!==V&&void 0!==V&&V.uid||null!==B&&void 0!==B&&B.uid)){li({url:"/medias",ids:{ids:i}})}(z||$)&&e("/banner")}),[R,Y]),(0,d.useEffect)((()=>{T&&a.ZP.error(M.message),ei&&a.ZP.error(ii.message)}),[M,ii]),(0,d.useEffect)((()=>{""!==l&&H()}),[l]),(0,d.useEffect)((()=>{""===l&&i.setFieldsValue(j)}),[]),(0,d.useEffect)((()=>{var e,l,d,o,a,n,t,r,u;const s=[{uid:null===Q||void 0===Q||null===(e=Q.imageLogo)||void 0===e?void 0:e._id,name:null===Q||void 0===Q||null===(l=Q.imageLogo)||void 0===l?void 0:l.name,status:"done",url:"".concat("https://namangan.leapmotorca.uz/api","/").concat(null===Q||void 0===Q||null===(d=Q.imageLogo)||void 0===d?void 0:d.path)}],v=[{uid:null===Q||void 0===Q||null===(o=Q.imageBrand)||void 0===o?void 0:o._id,name:null===Q||void 0===Q||null===(a=Q.imageBrand)||void 0===a?void 0:a.name,status:"done",url:"".concat("https://namangan.leapmotorca.uz/api","/").concat(null===Q||void 0===Q||null===(n=Q.imageBrand)||void 0===n?void 0:n.path)}],c=[{uid:null===Q||void 0===Q||null===(t=Q.videoBanner)||void 0===t?void 0:t._id,name:null===Q||void 0===Q||null===(r=Q.videoBanner)||void 0===r?void 0:r.name,status:"done",url:"".concat("https://namangan.leapmotorca.uz/api","/").concat(null===Q||void 0===Q||null===(u=Q.videoBanner)||void 0===u?void 0:u.path)}];if(W){const e={mediaLogoId:s,mediaBrandId:v,mediaVideoId:c};O(s),Z(v),S(c),i.setFieldsValue(e)}}),[Q]),(0,d.useEffect)((()=>{var i,e,d,o,a,n;let t="",r="",u="";var s,v,c,m,g,p,b,f,j,F,O,Z,S,y,L;if(W&&N&&null!==(i=h[0])&&void 0!==i&&null!==(e=i.originFileObj)&&void 0!==e&&e.uid)t=null===(s=J[0])||void 0===s?void 0:s._id;else if(W){var E;t=null===(E=h[0])||void 0===E?void 0:E.uid}if(W&&N&&null!==(d=I[0])&&void 0!==d&&null!==(o=d.originFileObj)&&void 0!==o&&o.uid)r=null===(v=w[0])||void 0===v||null===(c=v.originFileObj)||void 0===c||!c.uid||null!==(m=h[0])&&void 0!==m&&null!==(g=m.originFileObj)&&void 0!==g&&g.uid?3===J.length?null===(p=J[1])||void 0===p?void 0:p._id:2===J.length?null===(b=J[1])||void 0===b?void 0:b._id:null===(f=J[0])||void 0===f?void 0:f._id:null===(j=J[0])||void 0===j?void 0:j._id;else if(W){var P;r=null===(P=I[0])||void 0===P?void 0:P.uid}if(W&&N&&null!==(a=w[0])&&void 0!==a&&null!==(n=a.originFileObj)&&void 0!==n&&n.uid)u=3===J.length?null===(F=J[2])||void 0===F?void 0:F._id:2===J.length?null===(O=J[1])||void 0===O?void 0:O._id:null===(Z=J[0])||void 0===Z?void 0:Z._id;else if(W){var D;u=null===(D=w[0])||void 0===D?void 0:D.uid}!W&&J&&(t=null===(S=J[0])||void 0===S?void 0:S._id,r=null===(y=J[1])||void 0===y?void 0:y._id,u=null===(L=J[2])||void 0===L?void 0:L._id);const V={mediaLogoId:t,mediaBrandId:r,mediaVideoId:u};N&&!W?U({url:"/banner",data:V}):(x||N)&&K({url:"/banner",data:V,id:l})}),[J,y]);(0,d.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],i.setFieldsValue(e));const l=()=>{localStorage.setItem("myFormValues",JSON.stringify(i.getFieldsValue()))};return window.addEventListener("beforeunload",l),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",l)}}),[]);const di=async i=>{let e=i.url;e||(e=await new Promise((e=>{const l=new FileReader;l.readAsDataURL(i.originFileObj),l.onload=()=>e(l.result)})));const l=new Image;l.src=e;const d=window.open(e);null===d||void 0===d||d.document.write(l.outerHTML)};return(0,f.jsx)("div",{children:G||k||A||X?(0,f.jsx)(m.QP,{}):(0,f.jsxs)(o.Z,{form:i,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:i=>{const e=new FormData;let l=!1;var d,o,a,n,t,r,u,s,v,c,m,g,p,b,f,j,F,O,Z,S,y,x,P,D,V,_,B,C,U,R;if(W)if(null!==(d=h[0])&&void 0!==d&&null!==(o=d.originFileObj)&&void 0!==o&&o.uid&&null!==(a=I[0])&&void 0!==a&&null!==(n=a.originFileObj)&&void 0!==n&&n.uid&&null!==(t=w[0])&&void 0!==t&&null!==(r=t.originFileObj)&&void 0!==r&&r.uid)l=!0,e.append("media",null===(V=h[0])||void 0===V?void 0:V.originFileObj),e.append("media",null===(_=I[0])||void 0===_?void 0:_.originFileObj),e.append("media",null===(B=w[0])||void 0===B?void 0:B.originFileObj),E(!1);else if(null!==(u=h[0])&&void 0!==u&&null!==(s=u.originFileObj)&&void 0!==s&&s.uid&&null!==(v=I[0])&&void 0!==v&&null!==(c=v.originFileObj)&&void 0!==c&&c.uid){var k,z;l=!0,e.append("media",null===(k=h[0])||void 0===k?void 0:k.originFileObj),e.append("media",null===(z=I[0])||void 0===z?void 0:z.originFileObj),E(!1)}else if(null!==(m=h[0])&&void 0!==m&&null!==(g=m.originFileObj)&&void 0!==g&&g.uid&&null!==(p=w[0])&&void 0!==p&&null!==(b=p.originFileObj)&&void 0!==b&&b.uid){var M,T;l=!0,e.append("media",null===(M=h[0])||void 0===M?void 0:M.originFileObj),e.append("media",null===(T=w[0])||void 0===T?void 0:T.originFileObj),E(!1)}else if(null!==(f=I[0])&&void 0!==f&&null!==(j=f.originFileObj)&&void 0!==j&&j.uid&&null!==(F=w[0])&&void 0!==F&&null!==(O=F.originFileObj)&&void 0!==O&&O.uid){var J,G;l=!0,e.append("media",null===(J=I[0])||void 0===J?void 0:J.originFileObj),e.append("media",null===(G=w[0])||void 0===G?void 0:G.originFileObj),E(!1)}else if(null!==(Z=h[0])&&void 0!==Z&&null!==(S=Z.originFileObj)&&void 0!==S&&S.uid){var A;l=!0,e.append("media",null===(A=h[0])||void 0===A?void 0:A.originFileObj),E(!1)}else if(null!==(y=I[0])&&void 0!==y&&null!==(x=y.originFileObj)&&void 0!==x&&x.uid){var Q;l=!0,e.append("media",null===(Q=I[0])||void 0===Q?void 0:Q.originFileObj),E(!1)}else if(null!==(P=w[0])&&void 0!==P&&null!==(D=P.originFileObj)&&void 0!==D&&D.uid){var H;l=!0,e.append("media",null===(H=w[0])||void 0===H?void 0:H.originFileObj),E(!1)}else l=!1,E(!0);else l=!0,e.append("media",null===(C=h[0])||void 0===C?void 0:C.originFileObj),e.append("media",null===(U=I[0])||void 0===U?void 0:U.originFileObj),e.append("media",null===(R=w[0])||void 0===R?void 0:R.originFileObj);l&&!N&&q({url:"/medias",formData:e}),L(i)},onFinishFailed:i=>{console.log("Failed:",i)},autoComplete:"off",children:[(0,f.jsxs)(n.Z,{gutter:20,children:[(0,f.jsx)(t.Z,{span:12,children:(0,f.jsx)(o.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaLogoId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,f.jsx)(s.Z,{rotationSlider:!0,children:(0,f.jsx)(r.Z,{maxCount:1,fileList:h,listType:"picture-card",onChange:e=>{let{fileList:l}=e;O(l),i.setFieldsValue({mediaLogoId:l})},onPreview:di,beforeUpload:()=>!1,onRemove:i=>{W&&D(i)},children:h.length>0?"":"Upload"})})})}),(0,f.jsx)(t.Z,{span:12,children:(0,f.jsx)(o.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0440\u0435\u043d\u0434\u0430",name:"mediaBrandId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0440\u0435\u043d\u0434\u0430"}],children:(0,f.jsx)(s.Z,{rotationSlider:!0,children:(0,f.jsx)(r.Z,{maxCount:1,fileList:I,listType:"picture-card",onChange:e=>{let{fileList:l}=e;Z(l),i.setFieldsValue({mediaBrandId:l})},onPreview:di,beforeUpload:()=>!1,onRemove:i=>{W&&_(i)},children:I.length>0?"":"Upload"})})})})]}),(0,f.jsx)(n.Z,{gutter:20,children:(0,f.jsx)(t.Z,{span:24,children:(0,f.jsx)(o.Z.Item,{label:"\u0411\u0430\u043d\u043d\u0435\u0440\u043d\u043e\u0435 \u0432\u0438\u0434\u0435\u043e",name:"mediaVideoId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u0438\u0434\u0435\u043e\u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,f.jsx)(r.Z,{maxCount:1,accept:"video/*",fileList:w,listType:"picture-card",onChange:e=>{let{fileList:l}=e;S(l),i.setFieldsValue({mediaVideoId:l})},onPreview:di,beforeUpload:()=>!1,onRemove:i=>{W&&C(i)},children:w.length>0?"":"Upload"})})})}),(0,f.jsx)(u.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:W?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=243.a0f13aaa.chunk.js.map