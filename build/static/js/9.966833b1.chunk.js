"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[9],{68438:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(74569),l=a.n(i);l().defaults.baseURL="".concat("https://qoraqalpogiston.leapmotorca.uz/api"),l().interceptors.request.use((e=>{const t=(e=>{try{return localStorage.getItem(e)}catch(t){console.log("Error getting data")}})("lptoken"),a=null!==t?"Bearer ".concat(t):"";return e.headers.authorization=a,e}));const s=l(),r={async getData(e){const{data:t}=await s.get(e);return t},async getDataByID(e,t){const{data:a}=await s.get("".concat(e,"/").concat(t));return a},async postData(e,t){const{data:a}=await s.post(e,t);return a},async editData(e,t,a){const{data:i}=await s.put("".concat(e,"/").concat(a),t);return i},async deleteData(e,t){await s.delete("".concat(e,"/").concat(t))},async deleteImages(e,t){console.log("delete image",t),await s.delete(e,{data:t})}}},9:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var i=a(72791),l=a(2409),s=a(50419),r=a(66106),o=a(30914),n=a(49389),d=a(93086),u=a(87309),c=a(68117),m=a(91933),g=a(68438),v=a(98986),p=a(57689),f=a(16030),h=a(77221),Z=a(80184);const w={titleRu:"",titleUz:"",mediaId:""},y=()=>{const[e]=l.Z.useForm(),t=(0,p.s0)(),{editId:a}=(0,f.v9)((e=>e.editData)),y=(0,f.I0)(),[j,x]=(0,i.useState)([]),[I,b]=(0,i.useState)({}),[F,S]=(0,i.useState)(!1),[E,D]=(0,i.useState)({}),{mutate:P,data:R,isLoading:U,isSuccess:L,error:z,isError:q}=(0,m.useMutation)((e=>{let{url:t,data:a}=e;return g.Z.postData(t,a)}),{onSuccess:()=>s.ZP.success("Success"),onError:e=>s.ZP.error(e.message)}),{mutate:V,data:C,isLoading:O,isSuccess:k}=(0,m.useMutation)((e=>{let{url:t,formData:a}=e;return g.Z.postData(t,a)}),{onError:e=>s.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{isLoading:M,data:T,refetch:J,isSuccess:B}=(0,m.useQuery)(["edit-filial",a],(()=>g.Z.getDataByID("/filial",a)),{enabled:!1}),{mutate:G,isLoading:N,data:_,isSuccess:A,error:Q,isError:H}=(0,m.useMutation)((e=>{let{url:t,data:a,id:i}=e;return g.Z.editData(t,a,i)}),{onError:e=>s.ZP.error(e.message)}),{mutate:W}=(0,m.useMutation)((e=>{let{url:t,ids:a}=e;return g.Z.deleteImages(t,a)}),{onSuccess:()=>s.ZP.success("Success"),onError:e=>s.ZP.error(e.message)});(0,i.useEffect)((()=>{let e=[];if(A&&y({type:h.Pb,payload:""}),B&&null!==E&&void 0!==E&&E.uid&&e.push(null===E||void 0===E?void 0:E.uid),B&&null!==E&&void 0!==E&&E.uid){W({url:"/medias",ids:{ids:e}})}(L||A)&&t("/filial")}),[R,_]),(0,i.useEffect)((()=>{q&&s.ZP.error(z.message),H&&s.ZP.error(Q.message)}),[z,Q]),(0,i.useEffect)((()=>{""!==a&&J()}),[a]),(0,i.useEffect)((()=>{""===a&&e.setFieldsValue(w)}),[]),(0,i.useEffect)((()=>{var t,a,i;const l=[{uid:null===T||void 0===T||null===(t=T.image)||void 0===t?void 0:t._id,name:null===T||void 0===T||null===(a=T.image)||void 0===a?void 0:a.name,status:"done",url:"".concat("https://qoraqalpogiston.leapmotorca.uz/api","/").concat(null===T||void 0===T||null===(i=T.image)||void 0===i?void 0:i.path)}];if(B){const t={titleRu:null===T||void 0===T?void 0:T.titleRu,titleUz:null===T||void 0===T?void 0:T.titleUz,mediaId:l};x(l),e.setFieldsValue(t)}}),[T]),(0,i.useEffect)((()=>{var e,t;let i="";var l,s;if(B&&k&&null!==(e=j[0])&&void 0!==e&&null!==(t=e.originFileObj)&&void 0!==t&&t.uid)i=null===(l=C[0])||void 0===l?void 0:l._id;else if(B){var r;i=null===(r=j[0])||void 0===r?void 0:r.uid}!B&&C&&(i=null===(s=C[0])||void 0===s?void 0:s._id);const o={titleRu:I.titleRu,titleUz:I.titleUz,mediaId:i};k&&!B?P({url:"/filial",data:o}):(F||k)&&G({url:"/filial",data:o,id:a})}),[C,I]);(0,i.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]);return(0,Z.jsx)("div",{children:O||U||M||N?(0,Z.jsx)(v.QP,{}):(0,Z.jsxs)(l.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:w,onFinish:e=>{const t=new FormData;let a=!1;var i,l,s,r;B?null!==(i=j[0])&&void 0!==i&&null!==(l=i.originFileObj)&&void 0!==l&&l.uid?(a=!0,t.append("media",null===(s=j[0])||void 0===s?void 0:s.originFileObj),S(!1)):(a=!1,S(!0)):(a=!0,t.append("media",null===(r=j[0])||void 0===r?void 0:r.originFileObj));a&&!k&&V({url:"/medias",formData:t}),b(e)},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,Z.jsxs)(r.Z,{gutter:20,children:[(0,Z.jsx)(o.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0422\u0435\u043a\u0441\u0442 Ru",name:"titleRu",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442 RU!"}],children:(0,Z.jsx)(n.default,{})})}),(0,Z.jsx)(o.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"Text Uz",name:"titleUz",rules:[{required:!0,message:"Text kiritish talab qilinadi Ru!"}],children:(0,Z.jsx)(n.default,{})})})]}),(0,Z.jsx)(r.Z,{gutter:20,children:(0,Z.jsx)(o.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,Z.jsx)(c.Z,{rotationSlider:!0,children:(0,Z.jsx)(d.Z,{maxCount:1,fileList:j,listType:"picture-card",onChange:t=>{let{fileList:a}=t;x(a),e.setFieldsValue({mediaId:a})},onPreview:async e=>{let t=e.url;t||(t=await new Promise((t=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>t(a.result)})));const a=new Image;a.src=t;const i=window.open(t);null===i||void 0===i||i.document.write(a.outerHTML)},beforeUpload:()=>!1,onRemove:e=>{B&&D(e)},children:j.length>0?"":"Upload"})})})})}),(0,Z.jsx)(u.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:B?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=9.966833b1.chunk.js.map